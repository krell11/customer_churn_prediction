# Customer Churn Prediction: Survival Analysis Approach

Данный проект посвящен прогнозированию оттока банковских клиентов. Для решения задачи используется подход анализа выживаемости Survival Analysis.

## Цель: Разработать модель машинного обучения на базе методов Survival Analysis (Анализ выживаемости), которая позволит ранжировать клиентов по риску оттока (Hazard Score). Это позволит бизнесу приоритезировать маркетинговые активности, фокусируясь на клиентах с наивысшим риском ухода в ближайшее время.

Входные данные: 
  * Данные о клиентах 
  * История транзакций (суммы, MCC-коды, валюты).
  * Временные метки формирования отчетов.

Выходные данные:
  * Оценка риска (Hazard Score) для каждого клиента


## Структура данных

В качестве метрики качества ранжирования будет использоваться C-index, реализация взята из sksurv (sksurv.metrics.concordance_index_censored).

Данные были взяты с DataFusion2024 с кейса по оттоку клиентов, для удобвства данные выложены на google drive, их можно загрузить по [ссылке](https://drive.google.com/drive/folders/1o-dVpimXTZPMZ5uCTFlFplRL5tQYZ-qM?usp=sharin)


## Предобработка, анализ и постановка задачи
В ходе разведочного анализа (EDA) была выявлена особенность данных: наличие временного разрыва между последними транзакциями клиентов и датами формирования отчетов. Использование скользящих окон (агрегации за последние 30/60/90 дней) показало низкую информативность из-за разреженности событий в этих периодах, поэтому было принято решение строить другие фичи, а именно:
* recency - Количество дней с момента последней транзакции клиента до даты формирования отчет, чем больше клиент не совершает покупки, тем больше вероятность, что он уже не вернется.
* total_cnt - Общее количество транзакций клиента за весь наблюдаемый период, так отображаем вовлеченность клиента, чем больше пользуется, тем более лояльный.
* total_sum - Сумма всех транзакций клиента, оцениваем насколько ценный клиент для нас (Применено логарифмирование для сглаживания выбросов).
* avg_check - Средний чек, отношение общей суммы трат к количеству транзакций.
* std_check - Стандартное отклонение сумм транзакций.
* unique_mcc - Разнообразие категорий.
* unique_currency - Валютная активность.
<img width="1984" height="484" alt="image" src="https://github.com/user-attachments/assets/61905621-a3cd-42a0-851b-f013c362bf0f" />

### При работе с данными было выявлено несколько особенностей:
* Тяжелые хвосты у признаков активности и денежных признаков, Большинство клиентов совершают мало транзакций, но есть клиенты с аномально высокими показателями, поэтому было применено логарифмирование к данным, чтобы нормализовать данные.
* Аномалия в Recency, минимальное значение признака recency составляет 101 день, это подтверждает гипотезу о временном разрыве в данных: в выборке отсутствуют данные о транзакциях за последние 3 месяца перед датой отчета
### Баланс классов:
Анализ целевой переменной target показал дисбаланс классов:
* Активные клиенты: ~ 91.5%
* Отток: ~ 8.5%
### Корреляционный анализ
Сконструированные фичи проверялись на линейную зависимость, матрица корреляций показала ожидаемую сильную линейную зависимость между: 
 - total count и uniquie_mcc
 - total sum и total count
Это не должно стать проблемой для бустинга
## Оценка качества
Анализ кривой Каплана-Майера показывает, что отток клиентов происходит относительно равномерно. К концу наблюдаемого периода (90 дней) кумулятивная доля ушедших клиентов достигает ~10%. Резкое падение вероятности выживания в последние дни периода может быть связано с особенностями цензурирования данных
<img width="865" height="556" alt="image" src="https://github.com/user-attachments/assets/e0f0625a-2cee-4e42-90b5-fb3c49807512" />

## Реализация модели

## Обсуждение и выводы

